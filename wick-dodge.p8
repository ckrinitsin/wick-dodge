pico-8 cartridge // http://www.pico-8.com
version 43
__lua__

function _init()
 if not game_over then
  cartdata(0)
 end
 fire_balls = {}
 game_over=false
 player.sprite=17
 player.timing=0.2
 score=0
 high_score=dget(0)
	palt(12, true)
	palt(0, false)
 music(0)
end

function _update()
 if game_over then
  animate_death()
  if btn(❎) then _init() end
  return
 end
 for fb in all(fire_balls) do
  fb:update()
 end
 player_update()
 update_score()
 update_high_score()
 add_fire_ball()
end

function _draw()
	cls()
	map()
	spr(player.sprite,
	 player.posx-player.radius,
	 player.posy-player.radius)
	for fb in all(fire_balls) do
	 fb:draw()
	end
	draw_score()
	draw_highscore()
	if player.sprite>=player.death_sprite_end then
	 draw_game_over()
	end
end
-->8
player = {
 posx = 50,
 posy = 50,
 velx = 0,
 vely = 0,
 vel_factor = 1,
 vel_loose = 0.75,
 timing = 0.20,
 sprite = 17,
 sprite_end = 20,
 death_sprite = 21,
 death_sprite_end = 28, 
 hitbox_radius = 2,
 radius = 4,
}

function player_update()
	input()
 movement()
 if collision_fire_balls() then
  game_over=true
  dset(0, high_score)
  player.sprite=player.death_sprite
  music(-1)
 end

	animate()
end

function input()
	if btn(0) then player.velx-=player.vel_factor end  --left
	if btn(1) then player.velx+=player.vel_factor end  --right
	if btn(2) then player.vely-=player.vel_factor end  --up
	if btn(3) then player.vely+=player.vel_factor end  --down
end

function map_collision(x,y,flag)
 return fget(mget(x,y),flag)
end

function collision_fire_balls()
 local tolerance = 3
 for fb in all(fire_balls) do
  if abs(player.posx-fb.posx) < tolerance
   and abs(player.posy-fb.posy) < tolerance
   then
    del(fire_balls, fb) 
    return true
   end
 end
 return false
end

function border_collision()
	if map_collision((player.posx-player.hitbox_radius)\8,
	 (player.posy-player.hitbox_radius)\8,0)
      or map_collision((player.posx+player.hitbox_radius)\8,
	    (player.posy+player.hitbox_radius)\8,0)
	 then
	 player.posx-=player.velx
	 player.posy-=player.vely
	 player.velx*=-1
	 player.vely*=-1
	end
end

function movement()
	player.posx+=player.velx
	player.posy+=player.vely
	border_collision()
	player.velx*=player.vel_loose
	player.vely*=player.vel_loose
end

function animate()
 if game_over then return end
 player.sprite+=player.timing
 if player.sprite >= player.sprite_end then player.sprite = 17 end
end

function animate_death()
 player.sprite+=player.timing
 if player.sprite >= player.death_sprite_end then player.timing = 0 end
end
-->8
spawn_rate=0.25
spawn_timer=0

function get_spawn_position()
 pos=rnd(128*4)
 if pos < 128 then
  return pos, 0-10
 elseif pos < 256 then
  return 128-10, pos-128
 elseif pos < 384 then
  return pos-256, 128-10
 else return 0-10, pos-384
 end
end

function get_direction()
 angle=rnd(1)*6.28318530
 return cos(angle),sin(angle)
end

function add_fire_ball()
 spawn_timer+=spawn_rate
 if spawn_timer < 1 then return end
 spawn_timer=0
 local x,y=get_spawn_position()
 local dx,dy=get_direction()
 add(fire_balls, {
  posx=x,
  posy=y,
  velx=dx,
  vely=dy,
  radius=2,
  draw=function(self)
   spr(33,self.posx-self.radius,self.posy-self.radius)
  end,
  update=function(self)
   self.posx+=self.velx
   self.posy+=self.vely
  end,
 })
end
-->8
score=0
score_delta=1
high_score=0

function update_score()
 score+=score_delta
end

function update_high_score()
 if score>high_score then
  high_score=score
 end
end

function draw_score()
 print(score,8,16,1)
end

function draw_highscore()
 print(high_score,105,16,10)
end

function draw_game_over()
 print("press ❎ to restart",26,8,1)
end
__gfx__
000000006665566666605666d0ddd0dd6566656655555555dddddd0000dddddddddddddd00000000dddddd0000dddddddddddddddddddddddddddddd00000000
0000000056666665560666650d000d005555555555555555dddddd0000dddddddddddddd00000000dddddd0000dddddddddddddddddddddddddddddd00000000
007007006655666666506666d0ddd0dd6665666555555555dddddd0000dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd00000000
000770006666665566dad6550d000d005555555555555555dddddd0000dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd00000000
000770005566666655dad666d0ddd0dd6566656655555555dddddd0000dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd00000000
0070070066665566666d55660d000d005555555555555555dddddd0000dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd00000000
000000006556666665566666d0ddd0dd6665666555555555dddddd0000dddddd00000000dddddddddddddddddddddddd00dddddddddddd00dddddddd00000000
0000000066666655666666550d000d005555555555555555dddddd0000dddddd00000000dddddddddddddddddddddddd00dddddddddddd00dddddddd00000000
00000000cccccccccccccccccccccccc00000000ccccc9cccccccccccccccccccccccccccccccccccccccccccccccccccccccccc000000000000000000000000
00000000cccc0cccccccccccccc0cccc00000000ccc98ccccccc9c9ccccccccccccccccccccccccccccccccccccccccccccccccc000000000000000000000000
00000000ccccc0ccccc0cccccccc0ccc00000000ccccc0ccccccc8ccccc99cccccc9cccccccccccccccccccccccccccccccccccc000000000000000000000000
00000000ccc7777ccccc0cccccc777cc00000000ccc7777cccc7777ccccc8ccccccc9ccccccccccccccccccccccccccccccccccc000000000000000000000000
00000000cc77777cccc777cccc77777c00000000cc77777ccc77777ccc77777ccccc8cccccc9ccccccccc9cccccccccccccccccc000000000000000000000000
00000000cc7777cccc77777ccc77777c00000000cc7777cccc7777cccc7777ccccc777cccccc8cccccc98ccccccc99cccccccccc000000000000000000000000
00000000cc7777cccc7777ccc77777cc00000000cc7777cccc7777cccc7777cccc7777cccc7777cccccc77cccccc8ccccccccccc000000000000000000000000
00000000c777777cc777777cc777777c00000000c777777cc777777cc777777ccc77777ccc77777cccc7777cccc7777ccccccccc000000000000000000000000
0000000ccccccccc0000000000000000ddadaadadddddddd00000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000ccccccccc0000000000000000ddaaaa9adddddddd00000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000cccc82ccc0000000000000000dddaaaadddadadad00000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000ccc8882cc0000000000000000ddddddddddaaa9ad00000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000ccc8888cc0000000000000000dddddddddddaaadd00000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000cccc88ccc0000000000000000dddddddddddddddd00000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000ccccccccc0000000000000000dddddddd0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000ccccccccc0000000000000000dddddddd0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000000000101010101010101010000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0e0e0e0e0e0e0e0e0e0e0e0e0e0e0e0e05050505050505050505050505050505050505050505050505050505050505050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0e0e0e0e0e0e0e0e0e0e0e0e0e0e0e0e05050505050505050505050505050505050505050505050505050505050505050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0d08080808080808080808082508080c05050505050505050505050505050505050505050505050505050505050505050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0605050505050505050505050505050705050505050505050505050505050505050505050505050505050505050505050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0605050505050505050505050505050705050505050505050505050505050505050505050505050505050505050505050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0605050505050505050505050505050705050505050505050505050505050505050505050505050505050505050505050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0605050505050505050505050505050705050505050505050505050505050505050505050505050505050505050505050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0605050505050505050505050505050705050505050505050505050505050505050505050505050505050505050505050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0605050505050505050505050505050705050505050505050505050505050505050505050505050505050505050505050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0605050505050505050505050505050705050505050505050505050505050505050505050505050505050505050505050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0605050505050505050505050505050705050505050505050505050505050505050505050505050505050505050505050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0605050505050505050505050505050705050505050505050505050505050505050505050505050505050505050505050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0605050505050505050505050505050705050505050505050505050505050505050505050505050505050505050505050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0605050505050505050505050505050705050505050505050505050505050505050505050505050505050505050505050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0605050505050505050505050505050705050505050505050505050505050505050505050505050505050505050505050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0a09090909090909090909090909090b05050505050505050505050505050505050505050505050505050505050505050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
011000200e775117750e775117750e775117750e775117750e775117750e775117750e775117750e7751177517775187751777518775177751877517775187751077513775107751377510775137751077513775
0110000000073006003f6000060034673006000060000600000730060000600006003467300600006000060000073006000060000600346733460300600006000007300600006000060034673006000060000600
011000001d3401d3311d3211d3111d3401d3311d3211d311213402133121321213111a3401a3311a3211a3111c3401c3311c3211c311243402433123340233312434024331243212431121340213312132121311
012000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0110000000073006000000000073346730060000073000030c0030c00300073006003467300600006000060000073006000007300600346733460300600006000007300600006002460034673006000060000600
011000002d4222d422294222942232422324222b4222b4222942229422284222842229422294222642228422244222442228422284222b4222b42228422284222642226422264222642224422244222442224422
__music__
01 00014244
01 00010244
00 00010244
00 00040244
00 00040244
00 00010205
00 00010205
00 00040205
02 00040205

